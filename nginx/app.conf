# Listens on 80 on your host
server {
  listen 80;
  server_name localhost;

  # --- Frontend SPA
  location / {
    proxy_pass http://${FRONTEND_HOST}:${FRONTEND_PORT};
    proxy_set_header Host $host;
  }

  # --- API under /projects/
  location /projects/ {
    proxy_pass http://${BACKEND_HOST}:${BACKEND_PORT}/projects/;
    include /etc/nginx/proxy_params;
    proxy_read_timeout 300;
    proxy_buffering off;   # helps if responses stream
  }

  # --- SSE endpoint
  location /stream {
    proxy_pass http://${BACKEND_HOST}:${BACKEND_PORT}/stream;
    proxy_http_version 1.1;
    proxy_set_header Connection '';
    proxy_buffering off;   # CRITICAL for SSE
    proxy_read_timeout 3600;
  }

  # optional: health
  location /health {
    proxy_pass http://${BACKEND_HOST}:${BACKEND_PORT}/health;
    include /etc/nginx/proxy_params;
  }
}
